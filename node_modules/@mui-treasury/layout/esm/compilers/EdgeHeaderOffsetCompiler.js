import HeaderEffect from "../effects/Header";
import { combineBreakpoints, pickNearestBreakpoint } from "../utils";
import { isCollapsibleSidebarConfig } from "../utils/sidebarChecker";
export default (function (edgeSidebar, header) {
  return {
    getResultStyle: function getResultStyle(sidebarId) {
      var result = {};
      var found = false;
      var configMap = edgeSidebar.configMapById[sidebarId];

      if (configMap) {
        var breakpoints = combineBreakpoints(configMap, header);
        breakpoints.forEach(function (bp) {
          var sidebarConfig = pickNearestBreakpoint(configMap, bp);
          var headerConfig = pickNearestBreakpoint(header, bp);

          if (sidebarConfig) {
            if (headerConfig && HeaderEffect(headerConfig).isObjectClipped(sidebarId) && isCollapsibleSidebarConfig(sidebarConfig)) {
              found = true;
              result[bp] = {
                height: headerConfig.initialHeight
              };
            } else if (found) {
              found = false;
              result[bp] = {
                height: 0
              };
            }
          }
        });
      }

      return result;
    }
  };
});